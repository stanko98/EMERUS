<%- include('partials/header', { title: title || `Tjedni Menu (${currentWeekDisplay}) - Emerus Kuhinja` }) %>

<div class="guest-menu-info" style="text-align: center; margin-bottom: 25px; padding: 15px; background-color: #eef; border-radius: var(--border-radius-md, 8px);">
    <p style="font-size: 1.1em; color: #333;">
    Molimo <a href="/login" style="color: var(--link-color); font-weight: bold; text-decoration: underline;">prijavite se</a> kako biste mogli odabrati željena jela za <strong style="color: var(--link-color);">SLJEDEĆI TJEDAN</strong>.
</p>
</div>

<h2 class="page-title">Popis jela za tjedan (<%= currentWeekDisplay %>):</h2>

<!-- Navigacija kroz tjedne -->
<div class="week-navigation" style="margin: 20px 0; display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid var(--border-color, #eee);">
    <% if (prevWeekLink) { %>
        <a href="<%= prevWeekLink %>" class="button button-small">« Prethodni tjedan</a>
    <% } else { %>
        <span style="visibility: hidden;"><a class="button button-small">« Prethodni tjedan</a></span>
    <% } %>
    <span style="font-weight: bold; color: var(--text-color, #333);">Odabir Tjedna</span>
    <% if (nextWeekLink) { %>
        <a href="<%= nextWeekLink %>" class="button button-small">Sljedeći tjedan »</a>
    <% } else { %>
        <span style="visibility: hidden;"><a class="button button-small">Sljedeći tjedan »</a></span>
    <% } %>
</div>

<%# --- VRAĆAMO OPISNE PORUKE NA VRHU OVDJE --- %>
<% if (isCurrentWeek) { %>
    <% if (isMenuPublished) { %>
        <p class="page-description" style="color: var(--primary-color); font-weight: bold;">Prikaz jelovnika za tekući tjedan</p>
    <% } else { %>
        <p class="page-description" style="color: #e67e22; font-weight:bold;">Jelovnik za tekući tjedan još nije službeno objavljen</p>
    <% } %>
<% } else if (isFutureWeek) { %>
    <p class="page-description" style="color: var(--primary-color); font-weight: bold;">
        Glasajte za idući tjedan</p>
<% } else { // Prošli tjedan %>
    <% if (isMenuPublished) { %>
        <p class="page-description" style="color: var(--primary-color); font-weight: bold;">Prikaz objavljenog jelovnika za odabrani prošli tjedan</p>
    <% } else { %>
        <p class="page-description" style="color: var(--primary-color); font-weight: bold;">Nema podataka o službeno objavljenom jelovniku za ovaj prošli tjedan</p>
    <% } %>
<% } %>
<!-- OPISNE PORUKE NA VRHU -->
<div class="meal-display" style="display: flex; flex-direction: column; align-items: center; gap: 20px;"> 
    <% if (workWeekDays && workWeekDays.length > 0) { %>
        <% workWeekDays.forEach(day => { %>
            <%
                const dayKey = day.dayKey;
                const menuItem = displayedMenu[dayKey];
                let dayDisplayName = (menuItem && menuItem.name) ? menuItem.name : (locals.DAY_DISPLAY_NAMES[dayKey] || dayKey.toUpperCase());
            %>
            
            <div class="day-card guest-day-card" style="width:100%; max-width:650px;">
                <h3><%= dayDisplayName %> (<%= formatDateToDDMMYYYY(day.date) %>)</h3>
                
                <%# --- KONAČNA ISPRAVLJENA LOGIKA --- %>
                <% if (isMenuPublished) { %>
                    <%# A. Ako je jelovnik OBJAVLJEN... %>
                    <% if (menuItem && menuItem.no_offer_today) { %>
                        <%# ...i ako je označeno "Nema ponude", prikaži SPECIJALNU crvenu poruku. %>
                        <p class="admin-info-italic no-offer-message" style="color: red; font-weight: bold;">
                            Nema ponude jela za ovaj dan - kuhinja ne radi.
                        </p>
                    <% } else if (menuItem && menuItem.meal_1) { %>
                        <%# ...ili ako ima jela, prikaži ih. %>
                        <div class="meal-option"><p><strong>1)</strong> <%- menuItem.meal_1 %></p></div>
                        <% if (menuItem.has_two_options && menuItem.meal_2) { %>
                            <div class="meal-option"><p><strong>2)</strong> <%- menuItem.meal_2 %></p></div>
                        <% } %>
                    <% } else { %>
                        <p class="admin-info-italic">Jelovnik za ovaj dan nije postavljen.</p>
                    <% } %>
                <% } else { %>
                    <%# B. Ako jelovnik NIJE objavljen, prikaži STANDARDNU, neutralnu poruku. %>
                    <p class="admin-info-italic futura-week-message" style="text-align: center;">Jelovnik za ovaj dan nije dostupan.</p>
                <% } %>
            </div>
        <% }); %>
    <% } %>
</div>

<%- include('partials/footer') %>

<style>
    .page-title { text-align: center; margin-bottom: 10px; }
    .page-description { text-align: center; margin-bottom: 20px; color: #555; font-size: 0.95rem; }
    .day-card.guest-day-card { 
        background-color: var(--card-background, #fff); 
        padding: 20px; 
        border-radius: var(--border-radius-md, 8px); 
        border: 1px solid var(--border-color, #e5e7eb); 
        box-shadow: var(--card-shadow, 0 2px 4px rgba(0,0,0,0.05)); 
    }
    .day-card.guest-day-card h3 { 
        color: var(--primary-color, #4CAF50); 
        text-align: center; 
        border-bottom: 1px solid var(--border-color, #eee); 
        padding-bottom: 10px; 
        margin-bottom: 15px; 
        margin-top:0; 
    }
    .day-card.guest-day-card .meal-option { 
        margin-bottom: 10px; 
        padding: 10px; 
        background-color: #f9f9f9; 
        border: 1px solid #eee; 
        border-radius: var(--border-radius-sm, 4px); 
    }
    .day-card.guest-day-card .meal-option p { margin:0; }
    .admin-info-italic { font-style: italic; color: #6b7280; margin-top: 10px; }
    .choice-prompt { font-style: italic; color: #555; font-size: 0.9em; margin-top: 5px; margin-bottom: 10px; }

    .futura-week-message,
    .current-week-not-published-message,
    .past-week-not-published-message,
    .no-offer-message,
    .centered-text {
        text-align: center;
    }
    .no-offer-message {
        color: #d35400; 
        font-weight:bold;
    }
</style>