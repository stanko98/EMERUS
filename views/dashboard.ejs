<%- include('partials/header', { title: 'Moj Tjedni Plan - EMERUS Kuhinja' }) %>

<h2 class="page-title">Popis jela kroz tjedan:</h2>
<p class="page-description">Odaberite željeno jelo za svaki dan. Ako ne označite nijednu opciju, smatrat će se da niste odabrali jelo za taj dan.</p>

<% if (message) { %>
    <p class="message <%= (typeof error !== 'undefined' && error) ? 'error-message' : 'success-message' %>"><%= message %></p>
<% } %>

<form action="/dashboard" method="POST" class="meal-form">
    <% daysOrder.forEach(dayKey => { %>
        <% const menuItem = weeklyMenu[dayKey]; %>
        <% if (menuItem) { %>
            <div class="day-card">
                <h3><%= menuItem.name %></h3>
                
                <!-- Opcija za Jelo 1 -->
                <div class="meal-option radio-option">
                    <input type="radio" 
                           id="choice_<%= dayKey %>_1" 
                           name="choices[<%= dayKey %>]" 
                           value="1"
                           <%= (userChoices[dayKey] === 1) ? 'checked' : '' %>>
                    <label for="choice_<%= dayKey %>_1">
                        <strong>1)</strong> <%= menuItem.meal_1 %>
                    </label>
                </div>

                <% if (menuItem.has_two_options) { %>
                    <!-- Opcija za Jelo 2 (ako postoji) -->
                    <div class="meal-option radio-option">
                        <input type="radio" 
                               id="choice_<%= dayKey %>_2" 
                               name="choices[<%= dayKey %>]" 
                               value="2"
                               <%= (userChoices[dayKey] === 2) ? 'checked' : '' %>>
                        <label for="choice_<%= dayKey %>_2">
                            <strong>2)</strong> <%= menuItem.meal_2 %>
                        </label>
                    </div>
                    
                    <% if (menuItem.option_2_prompt) { %> 
                        <p class="choice-prompt"><em><%= menuItem.option_2_prompt %></em></p>
                    <% } %>
                <% } %>
                
                <!-- Opcionalno: Link/gumb za brisanje odabira za dan -->
                <% if (userChoices[dayKey]) { // Pokaži samo ako postoji odabir %>
                    <div style="margin-top: 10px; text-align: right;">
                        <button type="button" 
                                class="button-small button-link-style" 
                                onclick="clearChoice('<%= dayKey %>')">
                            Poništi odabir za ovaj dan
                        </button>
                    </div>
                <% } %>
            </div>
        <% } %>
    <% }); %>
    <button type="submit" class="save-button">Spremi Sve Odabire</button>
</form>

<script>
function clearChoice(dayKey) {
    const radioButtons = document.querySelectorAll(`input[name="choices[${dayKey}]"]`);
    radioButtons.forEach(radio => {
        radio.checked = false;
    });
}
</script>

<style>
.radio-option {
    display: flex;
    align-items: center;
    padding: 10px;
    margin-bottom: 8px;
    border: 1px solid #eee;
    border-radius: var(--border-radius-sm, 4px);
    background-color: #f9f9f9;
}
.radio-option input[type="radio"] {
    margin-right: 10px;
    transform: scale(1.2);
}
.radio-option label {
    cursor: pointer;
    flex-grow: 1; 
}
.button-link-style { 
    background: none;
    border: none;
    color: var(--link-color, #007bff);
    text-decoration: underline;
    padding: 0;
    font-size: 0.85em;
    cursor: pointer;
}
.button-link-style:hover {
    color: var(--primary-color-dark, #0056b3);
}
</style>

<%- include('partials/footer') %>